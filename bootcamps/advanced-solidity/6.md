### Class 6 QA

### Improper Array Deletion in Solidity

**Vulnerability:** Using **delete** on array elements sets them to zero but keeps the array length unchanged, potentially breaking business logic by leaving "gaps" in the array.[blog.solidityscan.com](https://blog.solidityscan.com/improper-array-deletion-82672eed8e8d?gi=351cc84998dd)

**How it Occurs:** **delete arr[i]** zeros the element at index i without shifting or resizing the array, so length remains the same.<br/>

**Mitigation:** Shift elements left after deletion, swap with last element and pop, or use **arr.length = 0** for full reset.

### Q&A on Delegatecall and Related Topics

**Q: Are there different opcodes for delegatecall and normal external call?**<br/>
**A:** Yes - CALL and DELEGATECALL. CALL executes in callee's context (callee's storage/logic). DELEGATECALL uses callee's logic but caller's storage.

**Q: Is offset needed to access storage slots in Yul for reading variables in Huff?**<br/>
**A:** Yes. Yul and Huff require manual offset management for storage reads/writes, as slots are fixed at compile time.

**Q: Will Yul functions generate an ABI?**<br/>
**A:** ABIs work the same for Solidity and YUL. Use tools to generate it.

**Q: Is the read macro in this code snippet missing offset?**<br/>
**A:** Yes, it always reads from 0x00.

**Q: Why were the first sets of opcodes in the playground irrelevant?**<br/>
**A:** It was init code, discussed in the last lesson.

**Q: Why do PUSH1, PUSH2 not count as memory wastage, despite pushing less than 32 bytes?**<br/>
**A:** They only manipulate the stack, not memory.

**Q: Is Huff used much in industry, or is Solidity preferred?**<br/>
**A:** Huff is rarely used; Solidity is preferred due to lower error risk. Huff for experienced devs optimizing gas.

**Q: What happens when CODECOPY is triggered? Free memory gets overwritten?**<br/>
**A:** CODECOPY copies bytecode to memory, potentially overwriting free memory if not offset properly.

**Q: Will --ir give optimal Yul, or needs hand-refinement?**
**A:** Optimized to some extent, but not always for gas. Hand-optimization possible but requires expertise for marginal gains.
